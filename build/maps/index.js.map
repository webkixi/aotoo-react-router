{"version":3,"sources":["index.js"],"names":["blockPopstateEvent","window","addEventListener","props","flag","setTimeout","rootUrl","key","uri","_aotooReactTabs","require","Popstate","SAX","document","readyState","evt","preventDefault","stopImmediatePropagation","emit","_historyCount","fade","rein","out","back","left","in","right","_leftStack","animatecss","Aotoo","extend","opts","utile","dft","merge","location","href","split","Router","_Tabs","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","call","state","routerClass","mulitple","animate","animatein","animateType","animaterein","animateout","historyPush","bind","getRealContent","findPath","_inherits","Tabs","_createClass","value","_get","prototype","saxer","get","MenuData","menuData","select","on","prePageInfo","_path","path","_data","that","index","animateback","data","historyPop","contentData","selectItem","menu_data","type","historyItem","find","where","curHistoryState","history","pushState","preState","_history","length","timeLine","rightState","pop","cnt","InstanceContext","selectData","result","_typeof","enter","main","boxCls","id","content","oriContent","pre","rightIndex","_","findLastIndex","o","slice","direction","preContent","getContent","prePage","React","createElement","ref","uniqueId","className","push","origin","_pre","leave","curPageDom","refs","curPage","prePageDom","leaveContent","prevProps","prevState","cls","boxes_cls","jsxMenu","IscrollTreeMenu","onscroll","onscrollend","showMenu","Action","UPDATE","curState","classList","SELECT","ostate","ctx","cb","router","append","getWhereInfo","start","hasMounted","goto","config","target","$select","whereBack"],"mappings":"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","file":"../index.js","sourcesContent":["import {Tabs} from 'aotoo-react-tabs'\nrequire('aotoo-mixins-iscroll')\nconst Popstate = SAX('Popstate');\n(function() {\n  var blockPopstateEvent = document.readyState != \"complete\";\n  window.addEventListener(\"load\", function() {\n    setTimeout(function(){ blockPopstateEvent = false; }, 0)\n  }, false)\n  window.addEventListener(\"popstate\", function(evt) {\n    if (blockPopstateEvent && document.readyState==\"complete\") {\n      evt.preventDefault()\n      evt.stopImmediatePropagation()\n    } else {\n      Popstate.emit('goback')\n      // Popstate.trigger()\n    }\n  }, false)\n}())\n\nfunction pushState(props, nohash){\n\tconst flag = props.flag ? (typeof props.flag == 'boolean' ? '#' : props.flag) : ''\n\tconst uri = flag ? props.rootUrl + flag + props.key : props.rootUrl\n  window.history.pushState(props, '', uri)\n}\n\nlet _history = []\nlet _historyCount = 0\nlet _leftStack = []\nlet animatecss = {\n\tfade: {\n\t\tin: ' fadeIn animated-faster',\n\t\trein: ' fadeIn animated-fastest',\n\t\tout: ' fadeOut contentHide animated-fastest',\n\t\tback: ' fadeOut contentHide animated-faster'\n\t},\n\n\tleft: {\n\t\tin: ' fadeInLeft animated-faster',\n\t\trein: ' fadeIn animated-fastest',\n\t\tout: ' fadeOut contentHide animated-fastest',\n\t\tback: ' fadeOutLeft contentHide animated-faster'\n\t},\n\n\tright: {\n\t\tin: ' fadeInRight animated-faster',\n\t\trein: ' fadeIn animated-fastest',\n\t\tout: ' outHeight fadeOut contentHide animated-fastest',\n\t\tback: ' outHeight fadeOutRight contentHide animated-faster',\n\t}\n}\n\nAotoo.extend('router', function(opts, utile){\n  let dft = {\n    props: {\n      routerClass: 'routerGroup',\n      mulitple: false\n    }\n  }\n  opts = utile.merge(dft, opts)\n\n  if (opts.animatecss) {\n    animatecss = utile.merge(animatecss, opts.animatecss)\n    delete opts.animatecss\n  }\n\n  const rootUrl = location.href.split('#')[0]\n  class Router extends Tabs {\n    constructor(props){\n      super(props)\n      this.state = utile.merge(this.state, {\n        flag: true,\n        rootUrl: this.props.rootUrl || rootUrl,\n        direction: 'goto',\n        animate: this.props.animate || 'right'\n      })\n      this.prePageInfo\n\n      if (this.state.animate) {\n\t\t\t\tconst animateType = this.state.animate  // fade, left, right\n\t\t\t\tthis.animatein = animatecss[animateType]['in']\n\t\t\t\tthis.animaterein = animatecss[animateType]['rein']\n\t\t\t\tthis.animateout = animatecss[animateType]['out']\n\t\t\t\tthis.animateback = animatecss[animateType]['back']\n\t\t\t}\n\n      this.historyPush = this.historyPush.bind(this)\n      this.getRealContent = this.getRealContent.bind(this)\n      this.findPath = this.findPath.bind(this)\n    }\n    \n    componentWillMount() {\n      super.componentWillMount()\n      const that = this\n      const menuData = this.saxer.get().MenuData\n      const contentData = this.saxer.get().ContentData\n      const selectItem = menuData[this.state.select]\n      \n\n      this.on('historypush', function(opts){\n        const _path = opts.path\n        const _data = opts.data\n        const historyItem = that.findPath(_path)\n\n        that.historyPush({\n          index: historyItem.index,\n          key: historyItem.path,\n          data: _data||{}\n        })\n      })\n\n      this.on('historypop', function(opts){\n        return that.historyPop(opts)\n      })\n\n      this.emit('historypush', {\n        path: this.state.select,\n        data: {}\n      })\n    }\n\n    findPath(where){\n      const type = typeof where\n      const menu_data = this.saxer.get().MenuData\n      if (type == 'number') {\n        return menu_data[where]\n      }\n      if (type == 'string') {\n        return utile.find(menu_data, {path: where})\n      }\n    }\n\n    historyPush(props) {\n      if (this.state.flag) {\n        const curHistoryState = window.history.state\n        pushState({\n          index: props.index,\n          key: props.key,\n          path: props.key,\n          data: props.data,\n          rootUrl: this.state.rootUrl,\n          preState: curHistoryState,\n          timeLine: _historyCount,\n          flag: this.state.flag\n        })\n      } else {\n        pushState({\n          rootUrl: this.state.rootUrl,\n          flag: this.state.flag\n        }, true)\n      }\n\n      const preState = _history[_history.length - 1]\n      _history.push({\n        index: props.index,\n        key: props.key,\n        path: props.key,\n        data: props.data,\n        preState: preState,\n        timeLine: _historyCount\n      })\n\n      _historyCount++\n    }\n\n    historyPop(){\n      let state = _history.pop()\n      if (!state) return false\n      let rightState;\n      if (this.state.flag) {\n        rightState = (state && state.preState)\n        if (rightState) {\n          pushState({\n            index: rightState.index,\n            key: rightState.key,\n            data: rightState.data,\n            rootUrl: this.state.rootUrl,\n            preState: \"curHistoryState\",\n            flag: this.state.flag\n          })\n        }\n      } else {\n        rightState = _history.pop()\n        pushState({rootUrl: this.state.rootUrl, flag: this.state.flag}, true)\n      }\n\n      return rightState\n    }\n\n    getRealContent(cnt){\n      if (!cnt) return ' '\n      const InstanceContext = this.saxer.get().InstanceContext\n      const selectData = this.state.selectData\n      if (typeof cnt == 'function') {\n        let result = cnt(InstanceContext)\n        if (typeof result == 'object') {\n          if (result['$$typeof']) return result\n\n          // enter, leave, main, loaded\n          if (typeof result.enter == 'function') return result.enter(selectData)  \n          else if(typeof result.main == 'function') {\n            return result.main(selectData)\n          }\n        }\n      }\n      return cnt\n    }\n\n    getPage(boxCls){\n      const id = this.state.select\n      let pre, preId, prePage, preContent\n      const oriContent = this.getContent(id)\n      const content = this.getRealContent(oriContent)\n      \n      if (this.state.direction == 'jumpback') {\n        pre = _leftStack.length ? _leftStack[_leftStack.length - 1] : '';\n        let rightIndex = _.findLastIndex(_history, function(o) { return o.index == id })\n        if (rightIndex > -1) {\n          rightIndex += 1\n          _history = _history.slice(0, rightIndex) \n          _leftStack = _leftStack.slice(0, (rightIndex) )\n        }\n      }\n      else \n      if (this.state.direction == 'back') {\n        pre = _leftStack.pop()\n      } else {\n        pre = _leftStack.length ? _leftStack[_leftStack.length-1] : '';\n      }\n      \n      if (this.state.animate !== 'fade') {\n        if (pre && pre.id !== id) {\n          this.prePageInfo = pre\n          preContent = this.getRealContent(this.getContent(pre.id))\n          prePage = <div ref='prePage' key={utile.uniqueId('Router_Single_')} className={boxCls}>{preContent}</div>\n        }\n      } else {\n        prePage = <div ref='prePage' key={utile.uniqueId('Router_Single_')} className={boxCls} />\n      }\n      \n      \n      const curPage = <div \n          ref=\"curPage\" \n          key={utile.uniqueId('Router_Single_')} \n          className={boxCls}>\n          {content}\n        </div>\n      \n      // 下面的部分有顺序要求，不能随意放置\n      if (this.state.direction == 'goto') {\n        _leftStack.push({\n          id: id,\n          content: content,\n          origin: oriContent\n        })\n      }\n\n      return [\n        prePage,\n        curPage\n      ]\n    }\n\n    leaveContent(){\n      if (this.prePageInfo) {\n        const InstanceContext = this.saxer.get().InstanceContext\n        const _pre = this.prePageInfo.origin\n        if (typeof _pre == 'function') {\n          let result = _pre(InstanceContext)\n          if (typeof result == 'object') {\n            if (typeof result.leave == 'function') return result.leave()  \n          }\n        }\n      }\n    }\n\n    componentDidMount() {\n      let animatein = this.animatein\n      let animateout = this.animateout\n      if (this.state.direction == 'back' || this.state.direction == 'jumpback' ) {\n        animateout = this.animateback\n        animatein = this.animaterein\n      }\n      const curPageDom = this.refs.curPage\n      const prePageDom = this.refs.prePage\n      if (curPageDom) {\n        curPageDom.classList.value += animatein\n      }\n      if (prePageDom) {\n        prePageDom.classList.value += animateout\n      }\n      this.leaveContent()\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n      // this.leaveContent()\n    }\n\n    render(){\n      const cls = !this.props.routerClass ? 'routerGroup ' : 'routerGroup ' + this.props.routerClass\n      // const boxes_cls = !this.props.mulitple ? 'routerBoxes' : 'routerBoxes mulitple'\n      const boxes_cls = !this.props.mulitple ? (this.props.animate == 'left' ? 'routerBoxes boxLeft' : this.props.animate == 'right' ? 'routerBoxes boxRight' : 'routerBoxes') : 'routerBoxes mulitple'\n\n      const jsxMenu = this.saxer.get().MenuJsx\n      const content = this.getPage(boxes_cls)\n      const IscrollTreeMenu = Aotoo.iscroll(<div className='routerMenus'>{jsxMenu}</div>, {\n        onscroll: function(){},\n        onscrollend: function(){}\n      })\n\n      return (\n        <div className={cls}>\n          { this.state.showMenu ? <IscrollTreeMenu /> : '' }\n          {content}\n        </div>\n      )\n    }\n  }\n\n  const Action = {\n    UPDATE: function(ostate, opts, ctx){\n      let state = this.curState\n      state.data = opts.data\n      return state\n    },\n\n    SELECT: function(ostate, opts, ctx){\n      let state = this.curState\n\n      // select\n      state.select = opts.select\n\n      // selectData\n      if (opts.selectData) {\n        state.selectData = opts.selectData\n      }\n\n      if (opts.direction) {\n        state.direction = opts.direction || 'goto'\n      }\n\n      if (state.direction == 'goto') {\n        ctx.emit('historypush', {\n          path: state.select,\n          data: state.selectData\n        })\n      }\n      \n      if (typeof opts.cb == 'function') {\n        setTimeout(function() { opts.cb() }, 100);\n      }\n\n      return state\n    },\n  }\n\n  // const router = Aotoo(Tabs, Action, dft)\n  const router = Aotoo(Router, Action, dft)\n  \n  router.saxer.append({\n    InstanceContext: router\n  })\n\n  Popstate.on('goback', function(){\n    return router.back()\n  })\n\n  router.extend({\n    getWhereInfo: function(where){\n      const menu_data = this.saxer.get().MenuData\n      return utile.find(menu_data, {path: where})\n    },\n    start: function(id, data){\n      if (this.hasMounted()){\n        this.goto(id, data)\n      } else {\n        if (this.config && this.config.props) {\n          this.config.props.select = id\n          this.config.props.selectData = data\n        }\n      }\n    },\n    goto: function(where, data){\n      if (typeof where != 'string') return \n      const target = this.getWhereInfo(where)\n      this.$select({\n        select: target.index,\n        selectData: data,\n        direction: 'goto'\n      })\n    },\n    back: function(where, data){\n      if (where) {\n        if (typeof where != 'string') return \n        const target = this.getWhereInfo(where)\n        this.$select({\n          select: target.index,\n          selectData: data,\n          direction: 'jumpback'\n        })\n      } else {\n        const whereBack = this.emit('historypop')\n        // whereBack: {\n          // index: props.index,\n          // key: props.key,\n          // data: props.data,\n          // rootUrl: this.state.rootUrl,\n          // preState: curHistoryState,\n          // timeLine: _historyCount,\n          // flag: this.state.flag\n        //}\n        if (whereBack) {\n          this.$select({\n            select: whereBack.index,\n            selectData: whereBack.data,\n            direction: 'back'\n          })\n          return whereBack\n        } else {\n          pushState({rootUrl: rootUrl}, true)\n        }\n      }\n    }\n  })\n\n  return router\n})"]}