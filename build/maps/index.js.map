{"version":3,"sources":["index.js"],"names":["blockPopstateEvent","window","addEventListener","props","flag","setTimeout","rootUrl","key","uri","_aotooReactTabs","require","Popstate","SAX","document","readyState","evt","preventDefault","stopImmediatePropagation","emit","_historyCount","fade","rein","out","back","left","in","right","_leftStack","animatecss","Aotoo","extend","opts","utile","dft","merge","location","href","split","Router","_Tabs","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","call","mulitple","state","direction","animate","prePageInfo","animateType","animatein","animateout","historyPush","bind","getRealContent","findPath","_inherits","Tabs","_createClass","value","_get","prototype","saxer","get","MenuData","menuData","select","on","_path","path","_data","that","index","animateback","data","historyPop","contentData","selectItem","menu_data","type","historyItem","find","where","curHistoryState","history","pushState","preState","_history","length","timeLine","rightState","pop","cnt","InstanceContext","selectData","result","_typeof","enter","main","boxCls","id","pre","prePage","preContent","animaterein","getContent","uniqueId","className","oriContent","content","curPage","React","createElement","push","origin","leave","leaveContent","prevProps","prevState","routerClass","boxes_cls","getPage","IscrollTreeMenu","iscroll","jsxMenu","cls","showMenu","Action","UPDATE","_pre","ctx","SELECT","ostate","curState","onscrollend","cb","router","start","hasMounted","goto","config","target","getWhereInfo","$select","whereBack"],"mappings":"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","file":"../index.js","sourcesContent":["import {Tabs} from 'aotoo-react-tabs'\nrequire('aotoo-mixins-iscroll')\nconst Popstate = SAX('Popstate');\n(function() {\n  var blockPopstateEvent = document.readyState != \"complete\";\n  window.addEventListener(\"load\", function() {\n    setTimeout(function(){ blockPopstateEvent = false; }, 0)\n  }, false)\n  window.addEventListener(\"popstate\", function(evt) {\n    if (blockPopstateEvent && document.readyState==\"complete\") {\n      evt.preventDefault()\n      evt.stopImmediatePropagation()\n    } else {\n      Popstate.emit('goback')\n      // Popstate.trigger()\n    }\n  }, false)\n}())\n\nfunction pushState(props, nohash){\n\tconst flag = props.flag ? (typeof props.flag == 'boolean' ? '#' : props.flag) : ''\n\tconst uri = flag ? props.rootUrl + flag + props.key : props.rootUrl\n  window.history.pushState(props, '', uri)\n}\n\nlet _history = []\nlet _historyCount = 0\nlet _leftStack = []\nconst animatecss = {\n\tfade: {\n\t\tin: ' fadeIn animated-faster',\n\t\trein: ' fadeIn animated-fastest',\n\t\tout: ' fadeOut contentHide animated-fastest',\n\t\tback: ' fadeOut contentHide animated-faster'\n\t},\n\n\tleft: {\n\t\tin: ' fadeInLeft animated-faster',\n\t\trein: ' fadeIn animated-fastest',\n\t\tout: ' fadeOut contentHide animated-fastest',\n\t\tback: ' fadeOutLeft contentHide animated-faster'\n\t},\n\n\tright: {\n\t\tin: ' fadeInRight animated-faster',\n\t\trein: ' fadeIn animated-fastest',\n\t\tout: ' outHeight fadeOut contentHide animated-fastest',\n\t\tback: ' outHeight fadeOutRight contentHide animated-faster',\n\t}\n}\n\nAotoo.extend('router', function(opts, utile){\n  let dft = {\n    props: {\n      routerClass: 'routerGroup',\n      mulitple: false\n    }\n  }\n  opts = utile.merge(dft, opts)\n\n  const rootUrl = location.href.split('#')[0]\n  class Router extends Tabs {\n    constructor(props){\n      super(props)\n      this.state = utile.merge(this.state, {\n        flag: true,\n        rootUrl: this.props.rootUrl || rootUrl,\n        direction: 'goto',\n        animate: this.props.animate || 'right'\n      })\n      this.prePageInfo\n\n      if (this.state.animate) {\n\t\t\t\tconst animateType = this.state.animate  // fade, left, right\n\t\t\t\tthis.animatein = animatecss[animateType]['in']\n\t\t\t\tthis.animaterein = animatecss[animateType]['rein']\n\t\t\t\tthis.animateout = animatecss[animateType]['out']\n\t\t\t\tthis.animateback = animatecss[animateType]['back']\n\t\t\t}\n\n      this.historyPush = this.historyPush.bind(this)\n      this.getRealContent = this.getRealContent.bind(this)\n      this.findPath = this.findPath.bind(this)\n    }\n    \n    componentWillMount() {\n      super.componentWillMount()\n      const that = this\n      const menuData = this.saxer.get().MenuData\n      const contentData = this.saxer.get().ContentData\n      const selectItem = menuData[this.state.select]\n      \n\n      this.on('historypush', function(opts){\n        const _path = opts.path\n        const _data = opts.data\n        const historyItem = that.findPath(_path)\n\n        that.historyPush({\n          index: historyItem.index,\n          key: historyItem.path,\n          data: _data||{}\n        })\n      })\n\n      this.on('historypop', function(opts){\n        return that.historyPop(opts)\n      })\n\n      this.emit('historypush', {\n        path: this.state.select,\n        data: {}\n      })\n    }\n\n    findPath(where){\n      const type = typeof where\n      const menu_data = this.saxer.get().MenuData\n      if (type == 'number') {\n        return menu_data[where]\n      }\n      if (type == 'string') {\n        return utile.find(menu_data, {path: where})\n      }\n    }\n\n    historyPush(props){\n      if (this.state.flag) {\n        const curHistoryState = window.history.state\n        pushState({\n          index: props.index,\n          key: props.key,\n          data: props.data,\n          rootUrl: this.state.rootUrl,\n          preState: curHistoryState,\n          timeLine: _historyCount,\n          flag: this.state.flag\n        })\n      } else {\n        pushState({rootUrl: this.state.rootUrl, flag: this.state.flag}, true)\n      }\n\n      const preState = _history[_history.length-1]\n      _history.push({\n        index: props.index,\n        key: props.key,\n        data: props.data,\n        preState: preState,\n        timeLine: _historyCount\n      })\n\n      _historyCount++\n    }\n\n    historyPop(){\n      let state = _history.pop()\n      if (!state) return false\n      let rightState;\n      if (this.state.flag) {\n        rightState = (state && state.preState)\n        if (rightState) {\n          pushState({\n            index: rightState.index,\n            key: rightState.key,\n            data: rightState.data,\n            rootUrl: this.state.rootUrl,\n            preState: \"curHistoryState\",\n            flag: this.state.flag\n          })\n        }\n      } else {\n        rightState = _history.pop()\n        pushState({rootUrl: this.state.rootUrl, flag: this.state.flag}, true)\n      }\n\n      return rightState\n    }\n\n    getRealContent(cnt){\n      if (!cnt) return ' '\n      const InstanceContext = this.saxer.get().InstanceContext\n      const selectData = this.state.selectData\n      if (typeof cnt == 'function') {\n        let result = cnt(InstanceContext)\n        if (typeof result == 'object') {\n          if (result['$$typeof']) return result\n\n          // enter, leave, main, loaded\n          if (typeof result.enter == 'function') return result.enter(selectData)  \n          else if(typeof result.main == 'function') {\n            return result.main(selectData)\n          }\n        }\n      }\n      return cnt\n    }\n\n    getPage(boxCls){\n      const id = this.state.select\n      let animatein = this.animatein\n      let animateout = this.animateout\n      let pre, preId, prePage, preContent\n\n      if (this.state.direction == 'back') {\n        animateout = this.animateback\n        animatein =  this.animaterein\n        pre = _leftStack.pop()\n      } else {\n        pre = _leftStack.length ? _leftStack[_leftStack.length-1] : '';\n      }\n      \n      if (pre && pre.id !== id) {\n        this.prePageInfo = pre\n        preContent = this.getRealContent(this.getContent(pre.id))\n        prePage = <div key={utile.uniqueId('Router_Single_')} className={boxCls+animateout}>{preContent}</div>\n      }\n      \n      const oriContent = this.getContent(id)\n      const content = this.getRealContent(oriContent)\n      const curPage = <div key={utile.uniqueId('Router_Single_')} className={boxCls+animatein}>{content}</div>\n\n      _leftStack.push({\n        id: id,\n        content: content,\n        origin: oriContent\n      })\n\n      return [\n        prePage,\n        curPage\n      ]\n    }\n\n    leaveContent(){\n      if (this.prePageInfo) {\n        const InstanceContext = this.saxer.get().InstanceContext\n        const _pre = this.prePageInfo.origin\n        if (typeof _pre == 'function') {\n          let result = _pre(InstanceContext)\n          if (typeof result == 'object') {\n            if (typeof result.leave == 'function') return result.leave()  \n          }\n        }\n      }\n    }\n\n    componentDidMount() {\n      this.leaveContent()\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n      this.leaveContent()\n    }\n\n    render(){\n      const cls = !this.props.routerClass ? 'routerGroup ' : 'routerGroup ' + this.props.routerClass\n      const boxes_cls = !this.props.mulitple ? 'routerBoxes' : 'routerBoxes mulitple'\n\n      const jsxMenu = this.saxer.get().MenuJsx\n      const content = this.getPage(boxes_cls)\n      const IscrollTreeMenu = Aotoo.iscroll(<div className='routerMenus'>{jsxMenu}</div>, {\n        onscroll: function(){},\n        onscrollend: function(){}\n      })\n\n      return (\n        <div className={cls}>\n          { this.state.showMenu ? <IscrollTreeMenu /> : '' }\n          {content}\n        </div>\n      )\n    }\n  }\n\n  const Action = {\n    UPDATE: function(ostate, opts, ctx){\n      let state = this.curState\n      state.data = opts.data\n      return state\n    },\n\n    SELECT: function(ostate, opts, ctx){\n      let state = this.curState\n\n      // select\n      state.select = opts.select\n\n      // selectData\n      if (opts.data) {\n        state.selectData = opts.data\n      }\n\n      if (opts.direction) {\n        state.direction = opts.direction || 'goto'\n      }\n\n      if (state.direction == 'goto') {\n        ctx.emit('historypush', {\n          path: state.select,\n          data: state.selectData\n        })\n      }\n      \n      if (typeof opts.cb == 'function') {\n        setTimeout(function() { opts.cb() }, 100);\n      }\n\n      return state\n    },\n  }\n\n  // const router = Aotoo(Tabs, Action, dft)\n  const router = Aotoo(Router, Action, dft)\n  \n  router.saxer.append({\n    InstanceContext: router\n  })\n\n  Popstate.on('goback', function(){\n    return router.back()\n  })\n\n  router.extend({\n    getWhereInfo: function(where){\n      const menu_data = this.saxer.get().MenuData\n      return utile.find(menu_data, {path: where})\n    },\n    start: function(id, data){\n      if (this.hasMounted()){\n        this.goto(id, data)\n      } else {\n        if (this.config && this.config.props) {\n          this.config.props.select = id\n          this.config.props.selectData = data\n        }\n      }\n    },\n    goto: function(where, data){\n      if (typeof where != 'string') return \n      const target = this.getWhereInfo(where)\n      this.$select({\n        select: target.index,\n        selectData: data,\n        direction: 'goto'\n      })\n    },\n    back: function(where, data){\n      if (where) {\n        if (typeof where != 'string') return \n        const target = this.getWhereInfo(where)\n        this.$select({\n          select: target.index,\n          selectData: data,\n          direction: 'back'\n        })\n      } else {\n        const whereBack = this.emit('historypop')\n        // whereBack: {\n          // index: props.index,\n          // key: props.key,\n          // data: props.data,\n          // rootUrl: this.state.rootUrl,\n          // preState: curHistoryState,\n          // timeLine: _historyCount,\n          // flag: this.state.flag\n        //}\n        if (whereBack) {\n          this.$select({\n            select: whereBack.index,\n            selectData: whereBack.data,\n            direction: 'back'\n          })\n          return whereBack\n        } else {\n          pushState({rootUrl: rootUrl}, true)\n        }\n      }\n    }\n  })\n\n  return router\n})"]}