{"version":3,"sources":["index.js"],"names":["blockPopstateEvent","window","addEventListener","props","flag","setTimeout","rootUrl","key","uri","update","value","Popstate","emit","size","max","_cache","cache","Object","create","evt","preventDefault","stopImmediatePropagation","history","pushState","undefined","remove","_lru","Error","get","v","set","clear","_aotooReactTabs","require","SAX","document","readyState","lru","_historyCount","_leftStack","animatecss","in","rein","left","out","back","_history","right","fade","opts","utile","merge","dft","location","href","split","extend","_Tabs","Router","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","getPrototypeOf","call","routerClass","state","mulitple","direction","animateType","animate","animatein","animateout","historyPush","bind","getRealContent","findPath","_inherits","Tabs","_createClass","saxer","MenuData","ContentData","menuData","select","on","path","animaterein","that","index","historyItem","data","historyPop","where","type","_typeof","menu_data","_data","preState","curHistoryState","timeLine","find","push","rightState","pop","cnt","pre","InstanceContext","_pre","from","title","selectData","result","enter","main","boxCls","id","preContent","parent","length","rightIndex","o","slice","oriContent","content","getContent","prePage","React","createElement","ref","uniqueId","className","findLastIndex","curPage","prePageInfo","origin","leave","curPageDom","refs","prePageDom","classList","leaveContent","prevProps","prevState","cls","boxes_cls","jsxMenu","IscrollTreeMenu","onscroll","onscrollend","showMenu","Action","UPDATE","curState","SELECT","ostate","ctx","cb","router","Aotoo","condition","preback","append","hasMounted","goto","config","getWhereInfo","hasOn","h","whereami","target","$select","whereBack"],"mappings":"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","file":"../index.js","sourcesContent":["import {Tabs} from 'aotoo-react-tabs'\nrequire('aotoo-mixins-iscroll')\nconst Popstate = SAX('Popstate');\n(function() {\n  var blockPopstateEvent = document.readyState != \"complete\";\n  window.addEventListener(\"load\", function() {\n    setTimeout(function(){ blockPopstateEvent = false; }, 0)\n  }, false)\n  window.addEventListener(\"popstate\", function(evt) {\n    if (blockPopstateEvent && document.readyState==\"complete\") {\n      evt.preventDefault()\n      evt.stopImmediatePropagation()\n    } else {\n      Popstate.emit('goback')\n      // Popstate.trigger()\n    }\n  }, false)\n}())\n\nfunction pushState(props, nohash){\n\tconst flag = props.flag ? (typeof props.flag == 'boolean' ? '#' : props.flag) : ''\n\tconst uri = flag ? props.rootUrl + flag + props.key : props.rootUrl\n  window.history.pushState(props, '', uri)\n}\n\nfunction _lru(max) {\n  //https://github.com/dominictarr/hashlru\n  if (!max) throw Error('hashlru must have a max value, of type number, greater than 0')\n  var size = 0, cache = Object.create(null), _cache = Object.create(null)\n  function update(key, value) {\n    cache[key] = value\n    size++\n    if (size >= max) {\n      size = 0\n      _cache = cache\n      cache = Object.create(null)\n    }\n  }\n  return {\n    has: function (key) {\n      return cache[key] !== undefined || _cache[key] !== undefined\n    },\n    remove: function (key) {\n      if (cache[key] !== undefined)\n        cache[key] = undefined\n      if (_cache[key] !== undefined)\n        _cache[key] = undefined\n    },\n    get: function (key) {\n      var v = cache[key]\n      if (v !== undefined) return v\n      if (v = _cache[key]) {\n        update(key, v)\n        return v\n      }\n    },\n    set: function (key, value) {\n      if (cache[key] !== undefined) cache[key] = value\n      else update(key, value)\n    },\n    clear: function () {\n      cache = Object.create(null)\n      _cache = Object.create(null)\n    }\n  }\n}\n\n\nlet lru = _lru(50)\nlet _history = []\nlet _historyCount = 0\nlet _leftStack = []\nlet animatecss = {\n\tfade: {\n\t\tin: ' fadeIn animated-faster',\n\t\trein: ' fadeIn animated-fastest',\n\t\tout: ' fadeOut contentHide animated-fastest',\n\t\tback: ' fadeOut contentHide animated-faster'\n\t},\n\n\tleft: {\n\t\tin: ' fadeInLeft animated-faster',\n\t\trein: ' fadeIn animated-fastest',\n\t\tout: ' fadeOut contentHide animated-fastest',\n\t\tback: ' fadeOutLeft contentHide animated-faster'\n\t},\n\n\tright: {\n\t\tin: ' fadeInRight animated-faster',\n\t\trein: ' fadeIn animated-fastest',\n\t\tout: ' outHeight fadeOut contentHide animated-fastest',\n\t\tback: ' outHeight fadeOutRight contentHide animated-faster',\n\t}\n}\n\nAotoo.extend('router', function(opts, utile){\n  let dft = {\n    props: {\n      routerClass: 'routerGroup',\n      mulitple: false\n    }\n  }\n  opts = utile.merge(dft, opts)\n\n  if (opts.animatecss) {\n    animatecss = utile.merge(animatecss, opts.animatecss)\n    delete opts.animatecss\n  }\n\n  const rootUrl = location.href.split('#')[0]\n  class Router extends Tabs {\n    constructor(props){\n      super(props)\n      this.state = utile.merge(this.state, {\n        flag: true,\n        rootUrl: this.props.rootUrl || rootUrl,\n        direction: 'goto',\n        animate: this.props.animate || 'right'\n      })\n      this.prePageInfo\n\n      if (this.state.animate) {\n\t\t\t\tconst animateType = this.state.animate  // fade, left, right\n\t\t\t\tthis.animatein = animatecss[animateType]['in']\n\t\t\t\tthis.animaterein = animatecss[animateType]['rein']\n\t\t\t\tthis.animateout = animatecss[animateType]['out']\n\t\t\t\tthis.animateback = animatecss[animateType]['back']\n\t\t\t}\n\n      this.historyPush = this.historyPush.bind(this)\n      this.getRealContent = this.getRealContent.bind(this)\n      this.findPath = this.findPath.bind(this)\n    }\n    \n    componentWillMount() {\n      super.componentWillMount()\n      const that = this\n      const menuData = this.saxer.get().MenuData\n      const contentData = this.saxer.get().ContentData\n      const selectItem = menuData[this.state.select]\n      \n\n      this.on('historypush', function(opts){\n        const _path = opts.path\n        const _data = opts.data\n        const historyItem = that.findPath(_path)\n\n        that.historyPush({\n          index: historyItem.index,\n          key: historyItem.path,\n          data: _data||{}\n        })\n      })\n\n      this.on('historypop', function(opts){\n        return that.historyPop(opts)\n      })\n\n      this.emit('historypush', {\n        path: this.state.select,\n        data: {}\n      })\n    }\n\n    findPath(where){\n      const type = typeof where\n      const menu_data = this.saxer.get().MenuData\n      if (type == 'number') {\n        return menu_data[where]\n      }\n      if (type == 'string') {\n        return utile.find(menu_data, {path: where})\n      }\n    }\n\n    historyPush(props) {\n      if (this.state.flag) {\n        const curHistoryState = window.history.state\n        pushState({\n          index: props.index,\n          key: props.key,\n          path: props.key,\n          data: props.data,\n          rootUrl: this.state.rootUrl,\n          preState: curHistoryState,\n          timeLine: _historyCount,\n          flag: this.state.flag\n        })\n      } else {\n        pushState({\n          rootUrl: this.state.rootUrl,\n          flag: this.state.flag\n        }, true)\n      }\n\n      const preState = _history[_history.length - 1]\n      _history.push({\n        index: props.index,\n        key: props.key,\n        path: props.key,\n        data: props.data,\n        preState: preState,\n        timeLine: _historyCount\n      })\n\n      _historyCount++\n    }\n\n    historyPop(){\n      let state = _history.pop()\n      if (!state) return false\n      let rightState;\n      if (this.state.flag) {\n        rightState = (state && state.preState)\n        if (rightState) {\n          pushState({\n            index: rightState.index,\n            key: rightState.key,\n            data: rightState.data,\n            rootUrl: this.state.rootUrl,\n            preState: \"curHistoryState\",\n            flag: this.state.flag\n          })\n        }\n      } else {\n        rightState = _history.pop()\n        pushState({rootUrl: this.state.rootUrl, flag: this.state.flag}, true)\n      }\n\n      return rightState\n    }\n\n    getRealContent(cnt, pre){\n      if (!cnt) return ' '\n      let InstanceContext = this.saxer.get().InstanceContext || {}\n      let _pre = this.findPath(pre)\n      InstanceContext.from = (function() {\n        if (_pre) {\n          return {\n            index: _pre.index,\n            path: _pre.path,\n            title: _pre.title,\n            idf: _pre.idf,\n            parent: _pre.parent,\n            attr: _pre.attr\n          }\n        }\n      })()\n      const selectData = this.state.selectData\n      if (typeof cnt == 'function') {\n        let result = cnt(InstanceContext)\n        if (typeof result == 'object') {\n          if (result['$$typeof']) return result\n\n          // enter, leave, main, loaded\n          if (typeof result.enter == 'function') return result.enter(selectData)  \n          else if(typeof result.main == 'function') {\n            return result.main(selectData)\n          }\n        }\n      }\n      return cnt\n    }\n\n    getPage(boxCls){\n      const id = this.state.select\n      let pre, preId, prePage, preContent\n      let oriContent, content\n      oriContent = this.getContent(id)\n      \n      if (this.state.direction == 'jumpback') {\n        // content = lru.get(id)\n        // if (!content) {\n        //   oriContent = this.getContent(id)\n        //   content = this.getRealContent(oriContent)\n        // }\n\n        pre = _leftStack.length ? _leftStack[_leftStack.length - 1] : '';\n        let rightIndex = _.findLastIndex(_history, function(o) { return o.index == id })\n        if (rightIndex > -1) {\n          rightIndex += 1\n          _history = _history.slice(0, rightIndex) \n          _leftStack = _leftStack.slice(0, (rightIndex) )\n        }\n      }\n      else \n      if (this.state.direction == 'back') {\n        pre = _leftStack.pop()\n      } else {\n        pre = _leftStack.length ? _leftStack[_leftStack.length-1] : '';\n      }\n      \n      if (this.state.animate !== 'fade') {\n        if (pre && pre.id !== id) {\n          // this.prePageInfo = pre\n          // preContent = this.getRealContent(this.getContent(pre.id))\n\n          this.prePageInfo = pre\n          preContent = lru.get(pre.id)\n          if (!preContent) {\n            preContent = this.getRealContent(this.getContent(pre.id))\n          }\n\n          prePage = <div ref='prePage' key={utile.uniqueId('Router_Single_')} className={boxCls}>{preContent}</div>\n        }\n      } else {\n        prePage = <div ref='prePage' key={utile.uniqueId('Router_Single_')} className={boxCls} />\n      }\n\n      content = this.getRealContent(oriContent, pre)\n      \n      const curPage = <div \n          ref=\"curPage\" \n          key={utile.uniqueId('Router_Single_')} \n          className={boxCls}>\n          {content}\n        </div>\n      \n      // 下面的部分有顺序要求，不能随意放置\n      if (this.state.direction == 'goto') {\n        _leftStack.push({\n          id: id,\n          // origin: oriContent\n          // content: content,\n        })\n      }\n\n      lru.set(id, content)\n\n      return [\n        prePage,\n        curPage\n      ]\n    }\n\n    leaveContent(){\n      if (this.prePageInfo) {\n        const InstanceContext = this.saxer.get().InstanceContext\n        const _pre = this.prePageInfo.origin\n        if (typeof _pre == 'function') {\n          let result = _pre(InstanceContext)\n          if (typeof result == 'object') {\n            if (typeof result.leave == 'function') return result.leave()  \n          }\n        }\n      }\n    }\n\n    componentDidMount() {\n      let animatein = this.animatein\n      let animateout = this.animateout\n      if (this.state.direction == 'back' || this.state.direction == 'jumpback' ) {\n        animateout = this.animateback\n        animatein = this.animaterein\n      }\n      const curPageDom = this.refs.curPage\n      const prePageDom = this.refs.prePage\n      if (curPageDom) {\n        curPageDom.classList.value += animatein\n      }\n      if (prePageDom) {\n        prePageDom.classList.value += animateout\n      }\n      this.leaveContent()\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n      // this.leaveContent()\n    }\n\n    render(){\n      const cls = !this.props.routerClass ? 'routerGroup ' : 'routerGroup ' + this.props.routerClass\n      // const boxes_cls = !this.props.mulitple ? 'routerBoxes' : 'routerBoxes mulitple'\n      const boxes_cls = !this.props.mulitple ? (this.props.animate == 'left' ? 'routerBoxes boxLeft' : this.props.animate == 'right' ? 'routerBoxes boxRight' : 'routerBoxes') : 'routerBoxes mulitple'\n\n      const jsxMenu = this.saxer.get().MenuJsx\n      const content = this.getPage(boxes_cls)\n      const IscrollTreeMenu = Aotoo.iscroll(<div className='routerMenus'>{jsxMenu}</div>, {\n        onscroll: function(){},\n        onscrollend: function(){}\n      })\n\n      return (\n        <div className={cls}>\n          { this.state.showMenu ? <IscrollTreeMenu /> : '' }\n          {content}\n        </div>\n      )\n    }\n  }\n\n  const Action = {\n    UPDATE: function(ostate, opts, ctx){\n      let state = this.curState\n      state.data = opts.data\n      return state\n    },\n\n    SELECT: function(ostate, opts, ctx){\n      let state = this.curState\n\n      // select\n      state.select = opts.select\n\n      // selectData\n      if (opts.selectData) {\n        state.selectData = opts.selectData\n      }\n\n      if (opts.direction) {\n        state.direction = opts.direction || 'goto'\n      }\n\n      if (state.direction == 'goto') {\n        ctx.emit('historypush', {\n          path: state.select,\n          data: state.selectData\n        })\n      }\n      \n      if (typeof opts.cb == 'function') {\n        setTimeout(function() { opts.cb() }, 100);\n      }\n\n      return state\n    },\n  }\n\n  // const router = Aotoo(Tabs, Action, dft)\n  const router = Aotoo(Router, Action, dft)\n  router.condition = {\n    preback: 'preback'\n  }\n  \n  router.saxer.append({\n    InstanceContext: router\n  })\n\n  Popstate.on('goback', function(){\n    return router.back()\n  })\n\n  router.extend({\n    getWhereInfo: function(where){\n      const menu_data = this.saxer.get().MenuData\n      return utile.find(menu_data, {path: where})\n    },\n    start: function(id, data){\n      if (this.hasMounted()){\n        this.goto(id, data)\n      } else {\n        if (this.config && this.config.props) {\n          this.config.props.select = id\n          this.config.props.selectData = data\n        }\n      }\n    },\n    goto: function(where, data){\n      if (typeof where != 'string') return \n      const target = this.getWhereInfo(where)\n      this.$select({\n        select: target.index,\n        selectData: data,\n        direction: 'goto'\n      })\n    },\n    back: function(where, data){\n      let condition = {}\n      if (this.hasOn('preback')) {\n        const h = _history[_history.length-1]\n        const whereami = {\n          index: h.index,\n          path: h.path,\n          data: h.data,\n          pre: h.preState,\n          flag: h.flag\n        }\n        condition = this.emit('preback', whereami)\n        if (!condition) return \n      }\n      if (where) {\n        if (typeof where != 'string') return \n        const target = this.getWhereInfo(where)\n        this.$select({\n          select: target.index,\n          selectData: utile.merge({}, data, condition),\n          direction: 'jumpback'\n        })\n      } else {\n        const whereBack = this.emit('historypop')\n        // whereBack: {\n          // index: props.index,\n          // key: props.key,\n          // data: props.data,\n          // rootUrl: this.state.rootUrl,\n          // preState: curHistoryState,\n          // timeLine: _historyCount,\n          // flag: this.state.flag\n        //}\n        if (whereBack) {\n          this.$select({\n            select: whereBack.index,\n            selectData: utile.merge({}, whereBack.data, condition),\n            direction: 'back'\n          })\n          return whereBack\n        } else {\n          if (window.history.length) {\n            history.back()\n          } else {\n            pushState({rootUrl: rootUrl}, true)\n          }\n        }\n      }\n    }\n  })\n\n  return router\n})"]}