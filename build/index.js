"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _os(t){var e={},a=t.match(/(?:Android);?[\s\/]+([\d.]+)?/),i=t.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return e.mobile=!(!a&&!i),e}function once(t){var e=this.saxer.get("__id")+"_OPERATE",a=this.saxer.get(e);if(a){if("break"==a)return;this.saxer.set(e,"break")}else this.saxer.set(e,"break");stat&&(stat=!1,t(function(t){stat=!0}))}function pushState(t,e){var a=t.flag?"boolean"==typeof t.flag?"#":t.flag:"",i=a?t.rootUrl+a+t.key:t.rootUrl;window.history.pushState(t,"",i)}function _lru(t){function e(e,r){i[e]=r,++a>=t&&(a=0,o=i,i=Object.create(null))}if(!t)throw Error("hashlru must have a max value, of type number, greater than 0");var a=0,i=Object.create(null),o=Object.create(null);return{has:function(t){return void 0!==i[t]||void 0!==o[t]},remove:function(t){void 0!==i[t]&&(i[t]=void 0),void 0!==o[t]&&(o[t]=void 0)},get:function(t){var a=i[t];return void 0!==a?a:void 0!==(a=o[t])?(e(t,a),a):void 0},set:function(t,a){void 0!==i[t]?i[t]=a:e(t,a)},clear:function(){i=Object.create(null),o=Object.create(null)}}}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),_get=function t(e,a,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,a);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,a,i)}if("value"in o)return o.value;var n=o.get;if(void 0!==n)return n.call(i)},_aotooReactTabs=require("aotoo-react-tabs");require("aotoo-mixins-iscroll");var Popstate=SAX("Popstate"),_history=[],_historyCount=0,_leftStack=[],os,stat=!0;!function(){var t,e=!1;os=_os(navigator.userAgent),document.addEventListener("click",function(a){var i=a.target;"A"==i.nodeName&&(e=!1,t=i.href,e=i.href.indexOf("#")>-1)},!1);var a="complete"!=document.readyState;window.addEventListener("load",function(){setTimeout(function(){a=!1},0)},!1),window.addEventListener("popstate",function(i){a&&"complete"==document.readyState?(i.preventDefault(),i.stopImmediatePropagation()):(e||Popstate.emit("__goback"),t="",e=!1)},!1)}();var lru=_lru(50),animatecss={fade:{in:" fadeIn animated-faster",rein:" fadeIn animated-fastest",out:" fadeOut contentHide animated-fastest",back:" fadeOut contentHide animated-faster"},left:{in:" fadeInLeft animated-faster",rein:" fadeIn animated-fastest",out:" fadeOut contentHide animated-fastest",back:" fadeOutLeft contentHide animated-faster"},right:{in:" fadeInRight animated-faster",rein:" fadeIn animated-fastest",out:" outHeight fadeOut contentHide animated-fastest",back:" outHeight fadeOutRight contentHide animated-faster"}},__opts=void 0;Aotoo.extend("router",function(t,e){var a={storage:window.sessionStorage,likeApp:!1,gap:100,props:{routerClass:"routerGroup",mulitple:!1},iscrollConfig:{}};t=e.merge(a,t),__opts=t,t.animatecss&&(animatecss=e.merge(animatecss,t.animatecss),delete t.animatecss);var i=location.href.split("#")[0],o=function(a){function o(t){_classCallCheck(this,o);var a=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));if(a.state=e.merge(a.state,{flag:a.props.flag||"#",rootUrl:a.props.rootUrl||i,direction:"goto",animate:a.props.animate||"right"}),a.prePageInfo,a.state.animate){var r=a.state.animate;a.animatein=animatecss[r].in,a.animaterein=animatecss[r].rein,a.animateout=animatecss[r].out,a.animateback=animatecss[r].back}return a.historyPush=a.historyPush.bind(a),a.getRealContent=a.getRealContent.bind(a),a.findPath=a.findPath.bind(a),a}return _inherits(o,_aotooReactTabs.Tabs),_createClass(o,[{key:"componentWillMount",value:function(){_get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"componentWillMount",this).call(this);var t=this,e=this.saxer.get().MenuData;this.saxer.get().ContentData,e[this.state.select];this.on("historypush",function(e){var a=e.path,i=e.data,o=t.findPath(a);t.historyPush({index:o.index,key:o.path,data:i||{}})}),this.on("historypop",function(e){return t.historyPop(e)}),this.emit("historypush",{path:this.state.select,data:{}})}},{key:"findPath",value:function(t){var a=void 0===t?"undefined":_typeof(t),i=this.saxer.get().MenuData;return"number"==a?i[t]:"string"==a?e.find(i,{path:t}):void 0}},{key:"historyPush",value:function(t){if(this.state.flag){var e=window.history.state;pushState({index:t.index,key:t.key,path:t.key,data:t.data,rootUrl:this.state.rootUrl,preState:e,timeLine:_historyCount,flag:this.state.flag})}else pushState({rootUrl:this.state.rootUrl,flag:this.state.flag},!0);var a=_history[_history.length-1];_history.push({index:t.index,key:t.key,path:t.key,data:t.data,preState:a,timeLine:_historyCount}),_historyCount++}},{key:"historyPop",value:function(){var t=_history.pop();if(!t)return!1;var e=void 0;return this.state.flag?(e=t&&t.preState)&&pushState({index:e.index,key:e.key,data:e.data,rootUrl:this.state.rootUrl,preState:"curHistoryState",flag:this.state.flag}):(e=_history.pop(),pushState({rootUrl:this.state.rootUrl,flag:this.state.flag},!0)),e}},{key:"getRealContent",value:function(t,e){if(!t)return" ";var a=this.saxer.get().InstanceContext||{},i=this.findPath(e);a.from=function(){if(i)return{index:i.index,path:i.path,title:i.title,idf:i.idf,parent:i.parent,attr:i.attr}}();var o=this.state.selectData;if("function"==typeof t){var r=t(a);if("object"==(void 0===r?"undefined":_typeof(r))){if(r.$$typeof)return r;if("function"==typeof r.enter)return r.enter(o);if("function"==typeof r.main)return r.main(o)}}return t}},{key:"getPage",value:function(a){var i=this.saxer.get("__id")+"_OPERATE",o=this.saxer.get(i),r=this.state.select,n=void 0,s=void 0,c=void 0,f=void 0,u=void 0;if(f=this.getContent(r),"jumpback"==this.state.direction){n=_leftStack.length?_leftStack[_leftStack.length-1]:"";var l=_.findLastIndex(_history,function(t){return t.index==r});l>-1&&(l+=1,_history=_history.slice(0,l),_leftStack=_leftStack.slice(0,l))}else n="back"==this.state.direction?_leftStack.pop():_leftStack.length?_leftStack[_leftStack.length-1]:"";this.state.animate&&("fade"!=this.state.animate&&t.likeApp?n&&n.id!==r&&(this.prePageInfo=_extends({origin:this.getContent(n.id)},n),(c=lru.get(n.id))||(c=this.getRealContent(this.getContent(n.id))),s=React.createElement("div",{ref:"prePage",key:e.uniqueId("Router_Single_"),className:a},c)):(s=void 0,this.prePageInfo=n&&n.id!==r?_extends({origin:this.getContent(n.id)},n):"")),u=this.getRealContent(f,n);var h=React.createElement("div",{ref:"curPage",key:e.uniqueId("Router_Single_"),className:a},u);return"goto"==this.state.direction&&_leftStack.push({id:r}),lru.set(r,u),"break"==o&&this.saxer.set(i,"continue"),s?[s,h]:[h]}},{key:"leaveContent",value:function(){if(this.prePageInfo){var t=this.saxer.get().InstanceContext,e=this.prePageInfo.origin;if("function"==typeof e){var a=e(t);if("object"==(void 0===a?"undefined":_typeof(a))&&"function"==typeof a.leave)return a.leave()}}}},{key:"componentDidMount",value:function(){var t=this.animatein,e=this.animateout;"back"!=this.state.direction&&"jumpback"!=this.state.direction||(e=this.animateback,t=this.animaterein);var a=this.refs.curPage,i=this.refs.prePage;a&&(a.classList.value+=t),i&&(i.classList.value+=e),this.leaveContent()}},{key:"render",value:function(){var e=this.props.routerClass?"routerGroup "+this.props.routerClass:"routerGroup ",a=this.props.mulitple?"routerBoxes mulitple":"left"==this.props.animate?"routerBoxes boxLeft":"right"==this.props.animate?"routerBoxes boxRight":"routerBoxes",i=this.createMenu(),o=this.getPage(a),r=Aotoo.iscroll(React.createElement("div",{className:"routerMenus"},i),t.iscrollConfig);return React.createElement("div",{className:e},this.state.showMenu?React.createElement(r,null):"",o)}}]),o}(),r={UPDATE:function(t,e,a){var i=this.curState;return i.data=e.data,i},SELECT:function(t,e,a){var i=this.curState;return i.select=e.select,e.selectData&&(i.selectData=e.selectData),e.direction&&(i.direction=e.direction||"goto"),"goto"==i.direction&&a.emit("historypush",{path:i.select,data:i.selectData}),"function"==typeof e.cb&&setTimeout(function(){e.cb()},100),i}},n=Aotoo(o,r,a);n.__id=_.uniqueId("ROUTER_ID_"),n.saxer.set("__id",n.__id),n.condition={preback:"preback"},n.saxer.append({InstanceContext:n}),Popstate.on("__goback",function(t){return n.back()});return n.extend({getWhereInfo:function(t){var a=this.saxer.get().MenuData;return e.find(a,{path:t})},getHistory:function(t){return _history},setHistory:function(t){t&&(_history=t.history||_history,_leftStack=t.stack||_leftStack)},clearHistory:function(t){_history=[],_leftStack=[]},start:function(t,e){this.hasMounted()?this.goto(t,e):this.config&&this.config.props&&(this.config.props.select=t,this.config.props.selectData=e)},delete:function(){var t=void 0;if(this.storageName&&(t=this.storageName,a.storage[t]))return a.storage.removeItem(t),!0},save:function(t,e){var i=void 0;if(t){i=t;JSON.stringify(_history),JSON.stringify(_leftStack);var o=_history[_history.length-1],r={from:window.location,history:_history,stack:_leftStack,current:o};this.storageName=i,a.storage.setItem(i,JSON.stringify(r))}},restore:function(t,e){var i=void 0;if(t&&(i=t,a.storage[i])){var o=JSON.parse(a.storage[i]);if(a.storage.removeItem(i),o.history.length){var r={page:o.history.pop(),stack:o.stack.pop()};return _history=o.history,_leftStack=o.stack,this.start(r.page.path,r.page.data),!0}}},goto:function(t,e){var a=this;once.call(this,function(i){setTimeout(function(){i()},__opts.gap);var o=a.emit("_beforeGoto",{record:{history:_history},param:{path:t,data:e},setHistory:a.setHistory});a.off("_beforeGoto");var r=a.emit("beforeGoto",{record:{history:_history},param:{path:t,data:e},setHistory:a.setHistory});if(!o&&!r&&"string"==typeof t){var n=a.getWhereInfo(t);n&&a.$select({select:n.index,selectData:e,direction:"goto"})}})},back:function(t,a){var o=this;once.call(this,function(r){setTimeout(function(){r()},__opts.gap);var n=o.emit("_beforeBack",{record:{history:_history},param:{path:t,data:a},setHistory:o.setHistory});o.off("_beforeBack");var s=o.emit("beforeBack",{record:{history:_history},param:{path:t,data:a},setHistory:o.setHistory});if(!n&&!s){var c={};if(o.hasOn("preback")){var f=_history[_history.length-1],u={index:f.index,path:f.path,data:f.data,pre:f.preState,flag:f.flag};if(!(c=o.emit("preback",u)))return}if(t){if("string"!=typeof t)return;var l=o.getWhereInfo(t);l&&o.$select({select:l.index,selectData:e.merge({},a,c),direction:"jumpback"})}else{var h=o.emit("historypop");if(h)return o.$select({select:h.index,selectData:e.merge({},h.data,c),direction:"back"}),h;window.history.length?history.back():pushState({rootUrl:i},!0)}}})}}),n});
//# sourceMappingURL=maps/index.js.map
