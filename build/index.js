"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function pushState(t,e){var n=t.flag?"boolean"==typeof t.flag?"#":t.flag:"",a=n?t.rootUrl+n+t.key:t.rootUrl;window.history.pushState(t,"",a)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),_get=function t(e,n,a){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,a)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(a)},_aotooReactTabs=require("aotoo-react-tabs");require("aotoo-mixins-iscroll");var Popstate=SAX("Popstate");!function(){var t="complete"!=document.readyState;window.addEventListener("load",function(){setTimeout(function(){t=!1},0)},!1),window.addEventListener("popstate",function(e){t&&"complete"==document.readyState?(e.preventDefault(),e.stopImmediatePropagation()):Popstate.emit("goback")},!1)}();var _history=[],_historyCount=0,_leftStack=[],animatecss={fade:{in:" fadeIn animated-faster",rein:" fadeIn animated-fastest",out:" fadeOut contentHide animated-fastest",back:" fadeOut contentHide animated-faster"},left:{in:" fadeInLeft animated-faster",rein:" fadeIn animated-fastest",out:" fadeOut contentHide animated-fastest",back:" fadeOutLeft contentHide animated-faster"},right:{in:" fadeInRight animated-faster",rein:" fadeIn animated-fastest",out:" outHeight fadeOut contentHide animated-fastest",back:" outHeight fadeOutRight contentHide animated-faster"}};Aotoo.extend("router",function(t,e){var n={props:{routerClass:"routerGroup",mulitple:!1}};t=e.merge(n,t);var a=location.href.split("#")[0],o=function(t){function n(t){_classCallCheck(this,n);var o=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));if(o.state=e.merge(o.state,{flag:!0,rootUrl:o.props.rootUrl||a,direction:"goto",animate:o.props.animate||"right"}),o.prePageInfo,o.state.animate){var i=o.state.animate;o.animatein=animatecss[i].in,o.animaterein=animatecss[i].rein,o.animateout=animatecss[i].out,o.animateback=animatecss[i].back}return o.historyPush=o.historyPush.bind(o),o.getRealContent=o.getRealContent.bind(o),o.findPath=o.findPath.bind(o),o}return _inherits(n,_aotooReactTabs.Tabs),_createClass(n,[{key:"componentWillMount",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"componentWillMount",this).call(this);var t=this,e=this.saxer.get().MenuData;this.saxer.get().ContentData,e[this.state.select];this.on("historypush",function(e){var n=e.path,a=e.data,o=t.findPath(n);t.historyPush({index:o.index,key:o.path,data:a||{}})}),this.on("historypop",function(e){return t.historyPop(e)}),this.emit("historypush",{path:this.state.select,data:{}})}},{key:"findPath",value:function(t){var n=void 0===t?"undefined":_typeof(t),a=this.saxer.get().MenuData;return"number"==n?a[t]:"string"==n?e.find(a,{path:t}):void 0}},{key:"historyPush",value:function(t){if(this.state.flag){var e=window.history.state;pushState({index:t.index,key:t.key,data:t.data,rootUrl:this.state.rootUrl,preState:e,timeLine:_historyCount,flag:this.state.flag})}else pushState({rootUrl:this.state.rootUrl,flag:this.state.flag},!0);var n=_history[_history.length-1];_history.push({index:t.index,key:t.key,data:t.data,preState:n,timeLine:_historyCount}),_historyCount++}},{key:"historyPop",value:function(){var t=_history.pop();if(!t)return!1;var e=void 0;return this.state.flag?(e=t&&t.preState)&&pushState({index:e.index,key:e.key,data:e.data,rootUrl:this.state.rootUrl,preState:"curHistoryState",flag:this.state.flag}):(e=_history.pop(),pushState({rootUrl:this.state.rootUrl,flag:this.state.flag},!0)),e}},{key:"getRealContent",value:function(t){if(!t)return" ";var e=this.saxer.get().InstanceContext,n=this.state.selectData;if("function"==typeof t){var a=t(e);if("object"==(void 0===a?"undefined":_typeof(a))){if(a.$$typeof)return a;if("function"==typeof a.enter)return a.enter(n);if("function"==typeof a.main)return a.main(n)}}return t}},{key:"getPage",value:function(t){var n=this.state.select,a=this.animatein,o=this.animateout,i=void 0,r=void 0,s=void 0;"back"==this.state.direction?(o=this.animateback,a=this.animaterein,i=_leftStack.pop()):i=_leftStack.length?_leftStack[_leftStack.length-1]:"",i&&i.id!==n&&(this.prePageInfo=i,s=this.getRealContent(this.getContent(i.id)),r=React.createElement("div",{key:e.uniqueId("Router_Single_"),className:t+o},s));var u=this.getContent(n),c=this.getRealContent(u),f=React.createElement("div",{key:e.uniqueId("Router_Single_"),className:t+a},c);return _leftStack.push({id:n,content:c,origin:u}),[r,f]}},{key:"leaveContent",value:function(){if(this.prePageInfo){var t=this.saxer.get().InstanceContext,e=this.prePageInfo.origin;if("function"==typeof e){var n=e(t);if("object"==(void 0===n?"undefined":_typeof(n))&&"function"==typeof n.leave)return n.leave()}}}},{key:"componentDidMount",value:function(){this.leaveContent()}},{key:"componentDidUpdate",value:function(t,e){this.leaveContent()}},{key:"render",value:function(){var t=this.props.routerClass?"routerGroup "+this.props.routerClass:"routerGroup ",e=this.props.mulitple?"routerBoxes mulitple":"routerBoxes",n=this.saxer.get().MenuJsx,a=this.getPage(e),o=Aotoo.iscroll(React.createElement("div",{className:"routerMenus"},n),{onscroll:function(){},onscrollend:function(){}});return React.createElement("div",{className:t},this.state.showMenu?React.createElement(o,null):"",a)}}]),n}(),i={UPDATE:function(t,e,n){var a=this.curState;return a.data=e.data,a},SELECT:function(t,e,n){var a=this.curState;return a.select=e.select,e.data&&(a.selectData=e.data),e.direction&&(a.direction=e.direction||"goto"),"goto"==a.direction&&n.emit("historypush",{path:a.select,data:a.selectData}),"function"==typeof e.cb&&setTimeout(function(){e.cb()},100),a}},r=Aotoo(o,i,n);return r.saxer.append({InstanceContext:r}),Popstate.on("goback",function(){return r.back()}),r.extend({getWhereInfo:function(t){var n=this.saxer.get().MenuData;return e.find(n,{path:t})},start:function(t,e){this.hasMounted()?this.goto(t,e):this.config&&this.config.props&&(this.config.props.select=t,this.config.props.selectData=e)},goto:function(t,e){if("string"==typeof t){var n=this.getWhereInfo(t);this.$select({select:n.index,selectData:e,direction:"goto"})}},back:function(t,e){if(t){if("string"!=typeof t)return;var n=this.getWhereInfo(t);this.$select({select:n.index,selectData:e,direction:"back"})}else{var o=this.emit("historypop");if(o)return this.$select({select:o.index,selectData:o.data,direction:"back"}),o;pushState({rootUrl:a},!0)}}}),r});
//# sourceMappingURL=maps/index.js.map
