"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function ProgressFun(t){var e=_.merge({},t);return e.style&&e.style.enable&&delete e.style.enable,React.createElement("div",{className:"progress-slot"},React.createElement("div",{className:"progress-stat",style:e.style||{width:"0"}}))}function _os(t){var e={},o=t.match(/(?:Android);?[\s\/]+([\d.]+)?/),a=t.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return e.mobile=!(!o&&!a),e}function next(t){stat=!0}function once(t){var e=this;if(stat){stat=!1;var o=this.saxer.get("__id")+"_OPERATE",a=this.saxer.get(o);if(Progress.$width({width:"70%"}),a){if("break"==a)return;this.saxer.set(o,"break"),setTimeout(function(){e.saxer.set(o,"continue")},1e3)}else this.saxer.set(o,"break");t(next)}}function pushState(t,e){var o=t.flag?"boolean"==typeof t.flag?"#":t.flag:"",a=o?t.rootUrl+o+t.key:t.rootUrl;window.history.pushState(t,"",a)}function _lru(t){function e(e,i){a[e]=i,++o>=t&&(o=0,r=a,a=Object.create(null))}if(!t)throw Error("hashlru must have a max value, of type number, greater than 0");var o=0,a=Object.create(null),r=Object.create(null);return{has:function(t){return void 0!==a[t]||void 0!==r[t]},remove:function(t){void 0!==a[t]&&(a[t]=void 0),void 0!==r[t]&&(r[t]=void 0)},get:function(t){var o=a[t];return void 0!==o?o:void 0!==(o=r[t])?(e(t,o),o):void 0},set:function(t,o){void 0!==a[t]?a[t]=o:e(t,o)},clear:function(){a=Object.create(null),r=Object.create(null)}}}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a])}return t},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_get=function t(e,o,a){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,o);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,o,a)}if("value"in r)return r.value;var n=r.get;if(void 0!==n)return n.call(a)},_createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,o,a){return o&&t(e.prototype,o),a&&t(e,a),e}}(),_aotooReactTabs=require("aotoo-react-tabs");require("aotoo-mixins-iscroll");var Popstate=SAX("Popstate"),_history=[],_historyCount=0,_leftStack=[],os;Aotoo.inject.css("\n  .progress-slot {\n    width: 100%;\n    height: 2px;\n    padding: 0;\n    margin: 0;\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 999;\n  }\n\n  .progress-stat {\n    background-color: #ccc;\n    width: 0;\n    height: 2px;\n    padding: 0;\n    margin: 0;\n    -webkit-transition: all .2s ease-in-out;\n    transition: all .2s ease-in-out;\n  }\n");var ProgressClass=function(t){function e(t){_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o.state={width:o.props.width||{width:"0"},opacity:"1",backgroundColor:o.props.backgroundColor,height:o.props.height,enable:!0},o}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){return this.props.enable?React.createElement(ProgressFun,{style:this.state}):React.createElement(ProgressFun,{style:{height:"0"}})}}]),e}(),Progress=Aotoo(ProgressClass,{WIDTH:function(t,e){var o=this.curState;return o.width=e.width,o},OPACITY:function(t,e){var o=this.curState;return o.opacity=e.opacity,o}}),stat=!0;!function(){var t,e=!1;os=_os(navigator.userAgent),document.addEventListener("click",function(o){var a=o.target;"A"==a.nodeName&&(e=!1,t=a.href,e=a.href.indexOf("#")>-1)},!1);var o="complete"!=document.readyState;window.addEventListener("load",function(){setTimeout(function(){o=!1},0)},!1),window.addEventListener("popstate",function(a){o&&"complete"==document.readyState?(a.preventDefault(),a.stopImmediatePropagation()):(e||Popstate.emit("__goback"),t="",e=!1)},!1)}();var lru=_lru(50),animatecss={fade:{in:" fadeIn animated-faster",rein:" fadeIn animated-fastest",out:" fadeOut contentHide animated-fastest",back:" fadeOut contentHide animated-faster"},left:{in:" fadeInLeft animated-faster",rein:" fadeIn animated-fastest",out:" fadeOut contentHide animated-fastest",back:" fadeOutLeft contentHide animated-faster"},right:{in:" fadeInRight animated-faster",rein:" fadeIn animated-fastest",out:" outHeight fadeOut contentHide animated-fastest",back:" outHeight fadeOutRight contentHide animated-faster"}},__opts=void 0;Aotoo.extend("router",function(t,e){var o={storage:window.sessionStorage,progress:{backgroundColor:"#108ee9",enable:!0},likeApp:!1,gap:300,props:{routerClass:"routerGroup",mulitple:!1},iscrollConfig:{}};t=e.merge(o,t),__opts=t,t.animatecss&&(animatecss=e.merge(animatecss,t.animatecss),delete t.animatecss);var a=location.href.split("#")[0],r=function(o){function r(t){_classCallCheck(this,r);var o=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t));if(o.state=e.merge(o.state,{flag:o.props.flag||"#",rootUrl:o.props.rootUrl||a,direction:"goto",animate:o.props.animate||"right"}),o.prePageInfo,o.state.animate){var i=o.state.animate;o.animatein=animatecss[i].in,o.animaterein=animatecss[i].rein,o.animateout=animatecss[i].out,o.animateback=animatecss[i].back}return o.historyPush=o.historyPush.bind(o),o.getRealContent=o.getRealContent.bind(o),o.findPath=o.findPath.bind(o),o}return _inherits(r,_aotooReactTabs.Tabs),_createClass(r,[{key:"componentWillMount",value:function(){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"componentWillMount",this).call(this);var t=this,e=this.saxer.get().MenuData;this.saxer.get().ContentData,e[this.state.select];this.on("historypush",function(e){var o=e.path,a=e.data,r=t.findPath(o);t.historyPush({index:r.index,key:r.path,data:a||{}})}),this.on("historypop",function(e){return t.historyPop(e)}),this.emit("historypush",{path:this.state.select,data:{}})}},{key:"findPath",value:function(t){var o=void 0===t?"undefined":_typeof(t),a=this.saxer.get().MenuData;return"number"==o?a[t]:"string"==o?e.find(a,{path:t}):void 0}},{key:"historyPush",value:function(t){if(this.state.flag){var e=window.history.state;pushState({index:t.index,key:t.key,path:t.key,data:t.data,rootUrl:this.state.rootUrl,preState:e,timeLine:_historyCount,flag:this.state.flag})}else pushState({rootUrl:this.state.rootUrl,flag:this.state.flag},!0);var o=_history[_history.length-1];_history.push({index:t.index,key:t.key,path:t.key,data:t.data,preState:o,timeLine:_historyCount}),_historyCount++}},{key:"historyPop",value:function(){var t=_history.pop();if(!t)return!1;var e=void 0;return this.state.flag?(e=t&&t.preState)&&pushState({index:e.index,key:e.key,data:e.data,rootUrl:this.state.rootUrl,preState:"curHistoryState",flag:this.state.flag}):(e=_history.pop(),pushState({rootUrl:this.state.rootUrl,flag:this.state.flag},!0)),e}},{key:"getRealContent",value:function(t,e){if(!t)return" ";var o=this.saxer.get().InstanceContext||{},a=this.findPath(e);o.from=function(){if(a)return{index:a.index,path:a.path,title:a.title,idf:a.idf,parent:a.parent,attr:a.attr}}();var r=this.state.selectData;if("function"==typeof t){var i=t(o);if("object"==(void 0===i?"undefined":_typeof(i))){if(i.$$typeof)return i;if("function"==typeof i.enter)return i.enter(r);if("function"==typeof i.main)return i.main(r)}}return t}},{key:"getPage",value:function(o){var a=this.state.select,r=void 0,i=void 0,n=void 0,s=void 0,c=void 0;if(s=this.getContent(a),"jumpback"==this.state.direction){r=_leftStack.length?_leftStack[_leftStack.length-1]:"";var u=_.findLastIndex(_history,function(t){return t.index==a});u>-1&&(u+=1,_history=_history.slice(0,u),_leftStack=_leftStack.slice(0,u))}else r="back"==this.state.direction?_leftStack.pop():_leftStack.length?_leftStack[_leftStack.length-1]:"";this.state.animate&&("fade"!=this.state.animate&&t.likeApp?r&&r.id!==a&&(this.prePageInfo=_extends({origin:this.getContent(r.id)},r),(n=lru.get(r.id))||(n=this.getRealContent(this.getContent(r.id))),i=React.createElement("div",{ref:"prePage",key:e.uniqueId("Router_Single_"),className:o},n)):(i=void 0,this.prePageInfo=r&&r.id!==a?_extends({origin:this.getContent(r.id)},r):"")),c=this.getRealContent(s,r);var f=React.createElement("div",{ref:"curPage",key:e.uniqueId("Router_Single_"),className:o},c);return"goto"==this.state.direction&&_leftStack.push({id:a}),lru.set(a,c),i?[i,f]:[f]}},{key:"leaveContent",value:function(){if(this.prePageInfo){var t=this.saxer.get().InstanceContext,e=this.prePageInfo.origin;if("function"==typeof e){var o=e(t);if("object"==(void 0===o?"undefined":_typeof(o))&&"function"==typeof o.leave)return o.leave()}}}},{key:"componentDidMount",value:function(){var t=this.animatein,e=this.animateout;"back"!=this.state.direction&&"jumpback"!=this.state.direction||(e=this.animateback,t=this.animaterein);var o=this.refs.curPage,a=this.refs.prePage;o&&(o.classList.value+=t),a&&(a.classList.value+=e),this.leaveContent()}},{key:"render",value:function(){var e=this.props.routerClass?"routerGroup "+this.props.routerClass:"routerGroup ",o=this.props.mulitple?"routerBoxes mulitple":"left"==this.props.animate?"routerBoxes boxLeft":"right"==this.props.animate?"routerBoxes boxRight":"routerBoxes",a=this.createMenu(),r=this.getPage(o),i=Aotoo.iscroll(React.createElement("div",{className:"routerMenus"},a),t.iscrollConfig);return React.createElement("div",{className:e},React.createElement(Progress.x,t.progress),this.state.showMenu?React.createElement(i,null):"",r)}}]),r}(),i={UPDATE:function(t,e,o){var a=this.curState;return a.data=e.data,a},SELECT:function(t,e,o){var a=this.curState;return a.select=e.select,e.selectData&&(a.selectData=e.selectData),e.direction&&(a.direction=e.direction||"goto"),"goto"==a.direction&&o.emit("historypush",{path:a.select,data:a.selectData}),"function"==typeof e.cb&&setTimeout(function(){e.cb()},100),a}},n=Aotoo(r,i,o);n.__id=_.uniqueId("ROUTER_ID_"),n.saxer.set("__id",n.__id),n.condition={preback:"preback"},n.on("rendered",function(t){var e=t.context,o=e.saxer.get("__id")+"_OPERATE";"break"==e.saxer.get(o)&&setTimeout(function(){Progress.$width({width:"100%"}),setTimeout(function(){Progress.$opacity({opacity:"0"}),setTimeout(function(){Progress.$width({width:"0"}),setTimeout(function(){Progress.$opacity({opacity:"1"}),e.saxer.set(o,"continue")},200)},100)},100)},500)}),n.saxer.append({InstanceContext:n}),n.progress={start:function(t){"object"==(void 0===t?"undefined":_typeof(t))&&t.width&&Progress.$width(t)},end:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;Progress.$width({width:"100%"}),setTimeout(function(){Progress.$opacity({opacity:"0"}),setTimeout(function(){Progress.$width({width:"0"})},300)},t)}},Popstate.on("__goback",function(t){return n.back()});return n.extend({getWhereInfo:function(t){var o=this.saxer.get().MenuData;return e.find(o,{path:t})},getHistory:function(t){return _history},setHistory:function(t){t&&(_history=t.history||_history,_leftStack=t.stack||_leftStack)},clearHistory:function(t){_history=[],_leftStack=[]},start:function(t,e){this.hasMounted()?this.goto(t,e):this.config&&this.config.props&&(this.config.props.select=t,this.config.props.selectData=e)},delete:function(){var t=void 0;if(this.storageName&&(t=this.storageName,o.storage[t]))return o.storage.removeItem(t),!0},save:function(t,e){var a=void 0;if(t){a=t;JSON.stringify(_history),JSON.stringify(_leftStack);var r=_history[_history.length-1],i={from:window.location,history:_history,stack:_leftStack,current:r};this.storageName=a,o.storage.setItem(a,JSON.stringify(i))}},restore:function(t,e){var a=void 0;if(t&&(a=t,o.storage[a])){var r=JSON.parse(o.storage[a]);if(o.storage.removeItem(a),r.history.length){var i={page:r.history.pop(),stack:r.stack.pop()};return _history=r.history,_leftStack=r.stack,this.start(i.page.path,i.page.data),!0}}},goto:function(t,e){var o=this;once.call(this,function(a){setTimeout(function(){a()},__opts.gap);var r=o.emit("_beforeGoto",{record:{history:_history},param:{path:t,data:e},setHistory:o.setHistory});o.off("_beforeGoto");var i=o.emit("beforeGoto",{record:{history:_history},param:{path:t,data:e},setHistory:o.setHistory});if(!r&&!i&&"string"==typeof t){var n=o.getWhereInfo(t);n&&o.$select({select:n.index,selectData:e,direction:"goto"})}})},back:function(t,o){var r=this;once.call(this,function(i){setTimeout(function(){i()},__opts.gap);var n=r.emit("_beforeBack",{record:{history:_history},param:{path:t,data:o},setHistory:r.setHistory});r.off("_beforeBack");var s=r.emit("beforeBack",{record:{history:_history},param:{path:t,data:o},setHistory:r.setHistory});if(!n&&!s){var c={};if(r.hasOn("preback")){var u=_history[_history.length-1],f={index:u.index,path:u.path,data:u.data,pre:u.preState,flag:u.flag};if(!(c=r.emit("preback",f)))return}if(t){if("string"!=typeof t)return;var l=r.getWhereInfo(t);l&&r.$select({select:l.index,selectData:e.merge({},o,c),direction:"jumpback"})}else{var h=r.emit("historypop");if(h)return r.$select({select:h.index,selectData:e.merge({},h.data,c),direction:"back"}),h;window.history.length?history.back():pushState({rootUrl:a},!0)}}})}}),n});
//# sourceMappingURL=maps/index.js.map
