"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function pushState(t,e){var a=t.flag?"boolean"==typeof t.flag?"#":t.flag:"",n=a?t.rootUrl+a+t.key:t.rootUrl;window.history.pushState(t,"",n)}function _lru(t){function e(e,o){n[e]=o,++a>=t&&(a=0,i=n,n=Object.create(null))}if(!t)throw Error("hashlru must have a max value, of type number, greater than 0");var a=0,n=Object.create(null),i=Object.create(null);return{has:function(t){return void 0!==n[t]||void 0!==i[t]},remove:function(t){void 0!==n[t]&&(n[t]=void 0),void 0!==i[t]&&(i[t]=void 0)},get:function(t){var a=n[t];return void 0!==a?a:(a=i[t])?(e(t,a),a):void 0},set:function(t,a){void 0!==n[t]?n[t]=a:e(t,a)},clear:function(){n=Object.create(null),i=Object.create(null)}}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),_get=function t(e,a,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,a);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,a,n)}if("value"in i)return i.value;var r=i.get;if(void 0!==r)return r.call(n)},_aotooReactTabs=require("aotoo-react-tabs");require("aotoo-mixins-iscroll");var Popstate=SAX("Popstate");!function(){var t="complete"!=document.readyState;window.addEventListener("load",function(){setTimeout(function(){t=!1},0)},!1),window.addEventListener("popstate",function(e){t&&"complete"==document.readyState?(e.preventDefault(),e.stopImmediatePropagation()):Popstate.emit("goback")},!1)}();var lru=_lru(50),_history=[],_historyCount=0,_leftStack=[],animatecss={fade:{in:" fadeIn animated-faster",rein:" fadeIn animated-fastest",out:" fadeOut contentHide animated-fastest",back:" fadeOut contentHide animated-faster"},left:{in:" fadeInLeft animated-faster",rein:" fadeIn animated-fastest",out:" fadeOut contentHide animated-fastest",back:" fadeOutLeft contentHide animated-faster"},right:{in:" fadeInRight animated-faster",rein:" fadeIn animated-fastest",out:" outHeight fadeOut contentHide animated-fastest",back:" outHeight fadeOutRight contentHide animated-faster"}};Aotoo.extend("router",function(t,e){var a={props:{routerClass:"routerGroup",mulitple:!1}};(t=e.merge(a,t)).animatecss&&(animatecss=e.merge(animatecss,t.animatecss),delete t.animatecss);var n=location.href.split("#")[0],i=function(t){function a(t){_classCallCheck(this,a);var i=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));if(i.state=e.merge(i.state,{flag:!0,rootUrl:i.props.rootUrl||n,direction:"goto",animate:i.props.animate||"right"}),i.prePageInfo,i.state.animate){var o=i.state.animate;i.animatein=animatecss[o].in,i.animaterein=animatecss[o].rein,i.animateout=animatecss[o].out,i.animateback=animatecss[o].back}return i.historyPush=i.historyPush.bind(i),i.getRealContent=i.getRealContent.bind(i),i.findPath=i.findPath.bind(i),i}return _inherits(a,_aotooReactTabs.Tabs),_createClass(a,[{key:"componentWillMount",value:function(){_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"componentWillMount",this).call(this);var t=this,e=this.saxer.get().MenuData;this.saxer.get().ContentData,e[this.state.select];this.on("historypush",function(e){var a=e.path,n=e.data,i=t.findPath(a);t.historyPush({index:i.index,key:i.path,data:n||{}})}),this.on("historypop",function(e){return t.historyPop(e)}),this.emit("historypush",{path:this.state.select,data:{}})}},{key:"findPath",value:function(t){var a=void 0===t?"undefined":_typeof(t),n=this.saxer.get().MenuData;return"number"==a?n[t]:"string"==a?e.find(n,{path:t}):void 0}},{key:"historyPush",value:function(t){if(this.state.flag){var e=window.history.state;pushState({index:t.index,key:t.key,path:t.key,data:t.data,rootUrl:this.state.rootUrl,preState:e,timeLine:_historyCount,flag:this.state.flag})}else pushState({rootUrl:this.state.rootUrl,flag:this.state.flag},!0);var a=_history[_history.length-1];_history.push({index:t.index,key:t.key,path:t.key,data:t.data,preState:a,timeLine:_historyCount}),_historyCount++}},{key:"historyPop",value:function(){var t=_history.pop();if(!t)return!1;var e=void 0;return this.state.flag?(e=t&&t.preState)&&pushState({index:e.index,key:e.key,data:e.data,rootUrl:this.state.rootUrl,preState:"curHistoryState",flag:this.state.flag}):(e=_history.pop(),pushState({rootUrl:this.state.rootUrl,flag:this.state.flag},!0)),e}},{key:"getRealContent",value:function(t,e){if(!t)return" ";var a=this.saxer.get().InstanceContext||{},n=this.findPath(e);a.from=function(){if(n)return{index:n.index,path:n.path,title:n.title,idf:n.idf,parent:n.parent,attr:n.attr}}();var i=this.state.selectData;if("function"==typeof t){var o=t(a);if("object"==(void 0===o?"undefined":_typeof(o))){if(o.$$typeof)return o;if("function"==typeof o.enter)return o.enter(i);if("function"==typeof o.main)return o.main(i)}}return t}},{key:"getPage",value:function(t){var a=this.state.select,n=void 0,i=void 0,o=void 0,r=void 0,s=void 0;if(r=this.getContent(a),"jumpback"==this.state.direction){n=_leftStack.length?_leftStack[_leftStack.length-1]:"";var c=_.findLastIndex(_history,function(t){return t.index==a});c>-1&&(c+=1,_history=_history.slice(0,c),_leftStack=_leftStack.slice(0,c))}else n="back"==this.state.direction?_leftStack.pop():_leftStack.length?_leftStack[_leftStack.length-1]:"";"fade"!==this.state.animate?n&&n.id!==a&&(this.prePageInfo=n,(o=lru.get(n.id))||(o=this.getRealContent(this.getContent(n.id))),i=React.createElement("div",{ref:"prePage",key:e.uniqueId("Router_Single_"),className:t},o)):i=React.createElement("div",{ref:"prePage",key:e.uniqueId("Router_Single_"),className:t}),s=this.getRealContent(r,n);var u=React.createElement("div",{ref:"curPage",key:e.uniqueId("Router_Single_"),className:t},s);return"goto"==this.state.direction&&_leftStack.push({id:a}),lru.set(a,s),[i,u]}},{key:"leaveContent",value:function(){if(this.prePageInfo){var t=this.saxer.get().InstanceContext,e=this.prePageInfo.origin;if("function"==typeof e){var a=e(t);if("object"==(void 0===a?"undefined":_typeof(a))&&"function"==typeof a.leave)return a.leave()}}}},{key:"componentDidMount",value:function(){var t=this.animatein,e=this.animateout;"back"!=this.state.direction&&"jumpback"!=this.state.direction||(e=this.animateback,t=this.animaterein);var a=this.refs.curPage,n=this.refs.prePage;a&&(a.classList.value+=t),n&&(n.classList.value+=e),this.leaveContent()}},{key:"componentDidUpdate",value:function(t,e){}},{key:"render",value:function(){var t=this.props.routerClass?"routerGroup "+this.props.routerClass:"routerGroup ",e=this.props.mulitple?"routerBoxes mulitple":"left"==this.props.animate?"routerBoxes boxLeft":"right"==this.props.animate?"routerBoxes boxRight":"routerBoxes",a=this.saxer.get().MenuJsx,n=this.getPage(e),i=Aotoo.iscroll(React.createElement("div",{className:"routerMenus"},a),{onscroll:function(){},onscrollend:function(){}});return React.createElement("div",{className:t},this.state.showMenu?React.createElement(i,null):"",n)}}]),a}(),o={UPDATE:function(t,e,a){var n=this.curState;return n.data=e.data,n},SELECT:function(t,e,a){var n=this.curState;return n.select=e.select,e.selectData&&(n.selectData=e.selectData),e.direction&&(n.direction=e.direction||"goto"),"goto"==n.direction&&a.emit("historypush",{path:n.select,data:n.selectData}),"function"==typeof e.cb&&setTimeout(function(){e.cb()},100),n}},r=Aotoo(i,o,a);return r.condition={preback:"preback"},r.saxer.append({InstanceContext:r}),Popstate.on("goback",function(){return r.back()}),r.extend({getWhereInfo:function(t){var a=this.saxer.get().MenuData;return e.find(a,{path:t})},start:function(t,e){this.hasMounted()?this.goto(t,e):this.config&&this.config.props&&(this.config.props.select=t,this.config.props.selectData=e)},goto:function(t,e){if("string"==typeof t){var a=this.getWhereInfo(t);this.$select({select:a.index,selectData:e,direction:"goto"})}},back:function(t,a){var i={};if(this.hasOn("preback")){var o=_history[_history.length-1],r={index:o.index,path:o.path,data:o.data,pre:o.preState,flag:o.flag};if(!(i=this.emit("preback",r)))return}if(t){if("string"!=typeof t)return;var s=this.getWhereInfo(t);this.$select({select:s.index,selectData:e.merge({},a,i),direction:"jumpback"})}else{var c=this.emit("historypop");if(c)return this.$select({select:c.index,selectData:e.merge({},c.data,i),direction:"back"}),c;window.history.length?history.back():pushState({rootUrl:n},!0)}}}),r});
//# sourceMappingURL=maps/index.js.map
